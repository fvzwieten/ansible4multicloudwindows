---
- name: create loadbalancer setup
  hosts: webservers:loadbalancers
  vars_files:
    files/winrm_vars
    
  tasks:
  - name: create empty list for collection of backend servers
    set_fact:
      backend_server_list: []
    when: "ansible_fqdn == 'loadbalancer.ibm.nontoonyt.com'"

  - name: populate loadbalancer list of dictionaries
    set_fact:
        backend_server_list: "{{ backend_server_list + [ {'name': item, 'address': '{{ ansible_ssh_host }}' + ':80'}] }}"
    loop: "{{ groups['webservers'] }}"
    when: "ansible_fqdn == 'loadbalancer.ibm.nontoonyt.com'"

- name: show backend hosts
  hosts: loadbalancers
  
  tasks:
  - name: show fact
    debug:
      var: backend_server_list
